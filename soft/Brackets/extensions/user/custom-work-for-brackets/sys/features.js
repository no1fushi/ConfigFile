/*global brackets,define,Mustache,localStorage,console*/define(function(require,exports,module){"use strict";var Dialogs=brackets.getModule("widgets/Dialogs"),Strings=brackets.getModule("strings"),Menus=brackets.getModule('command/Menus'),viewMenu=Menus.getMenu(Menus.AppMenuBar.NAVIGATE_MENU),CommandManager=brackets.getModule('command/CommandManager'),Commands=brackets.getModule("command/Commands"),PreferencesManager=brackets.getModule('preferences/PreferencesManager'),preferences=PreferencesManager.getExtensionPrefs("custom.work"),prefHoverSidebar="hoverSidebar",prefTooltip="tooltip",prefWorkingFiles="workingFilesSidebar",prefZIndex="zIndex",prefStepWheel="stepWheel",versionId="cw-version-in-localStorage",version=502,getVersion=localStorage.getItem(versionId),settingsDialogTemplate=require('text!./prefs.html');function addCommandMenu(name,id,fn,pos,rel){CommandManager.register(name,id,fn);viewMenu.addMenuItem(id,"",pos,rel);}function forFirstRun(){var getPref=function(pref){return preferences.get(pref);},number=function(pref,def){return("number"!==typeof getPref(pref)) ? def : getPref(pref);},setPref=function(elem){preferences.set(prefZIndex,parseInt(elem.find("#cw-zIndex").val(),10));preferences.set(prefStepWheel,parseInt(elem.find("#cw-stepWheel").val(),10));preferences.set(prefWorkingFiles,elem.find("#cw-workingFilesSidebar").is(":checked"));preferences.set(prefHoverSidebar,elem.find("#cw-hoverSidebar").is(":checked"));preferences.set(prefTooltip,elem.find("#cw-tooltip").is(":checked"));preferences.save();},prefsStore=function(elem){elem.find("#cw-zIndex").val(number(prefZIndex,11));elem.find("#cw-stepWheel").val(number(prefStepWheel,40));elem.find("#cw-workingFilesSidebar").prop('checked',getPref(prefWorkingFiles));elem.find("#cw-hoverSidebar").prop('checked',getPref(prefHoverSidebar));elem.find("#cw-tooltip").prop('checked',getPref(prefTooltip));},compiledTemplate=Mustache.render(settingsDialogTemplate,Strings),dialog=Dialogs.showModalDialogUsingTemplate(compiledTemplate,true);prefsStore(dialog.getElement());dialog.done(function(i){if("cancel"===i||"dontsave"===i){return;} else if("ok"===i){setPref(dialog.getElement());}});}function firstRun(){if(version<=parseInt(getVersion,10)){return;}localStorage.setItem(versionId,version);forFirstRun();}addCommandMenu("Custom Work for Brackets Preferences","PreferencesforCustomWorkforBrackets",function(){forFirstRun();},Menus.AFTER,Commands.NAVIGATE_PREV_DOC_LIST_ORDER);function news(){if(version>parseInt(getVersion,10)){localStorage.setItem(versionId,version);}}module.exports={firstRun: firstRun,news: news};});